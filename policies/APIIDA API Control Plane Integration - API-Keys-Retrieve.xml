<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="***************************"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="** APIIDA: Control Plane Integration"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="***************************"/>
        </L7p:CommentAssertion>
        <L7p:Encapsulated>
            <L7p:EncapsulatedAssertionConfigGuid stringValue="db047e91-52db-4176-a3eb-a43aa0c2c67c"/>
            <L7p:EncapsulatedAssertionConfigName stringValue="OTK Storage Configuration"/>
            <L7p:Parameters mapValue="included">
                <L7p:entry>
                    <L7p:key stringValue="custom"/>
                    <L7p:value stringValue=""/>
                </L7p:entry>
            </L7p:Parameters>
        </L7p:Encapsulated>
        <L7p:SetVariable>
            <L7p:AssertionComment assertionComment="included">
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="LEFT.COMMENT"/>
                        <L7p:value stringValue="error code"/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="RIGHT.COMMENT"/>
                        <L7p:value stringValue="overwritten in case of an error"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:AssertionComment>
            <L7p:Base64Expression stringValue=""/>
            <L7p:VariableToSet stringValue="error.code"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:AssertionComment assertionComment="included">
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="LEFT.COMMENT"/>
                        <L7p:value stringValue="DB location"/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="RIGHT.COMMENT"/>
                        <L7p:value stringValue="Set the location to access the database"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:AssertionComment>
            <L7p:Base64Expression stringValue="ZmFsc2U="/>
            <L7p:VariableToSet stringValue="isLocal"/>
        </L7p:SetVariable>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${host_oauth_clientstore_server}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item regex="included">
                            <L7p:Pattern stringValue="http[s]?://(localhost|127[.]0[.]0[.]1).+"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:SetVariable>
                    <L7p:AssertionComment assertionComment="included">
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="DB location"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Set the location to access the database"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:AssertionComment>
                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                    <L7p:VariableToSet stringValue="isLocal"/>
                </L7p:SetVariable>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${dbsystem}"/>
                            <L7p:Expression2 stringValue="cassandra"/>
                            <L7p:Negate booleanValue="true"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:RightValue stringValue="cassandra"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:CommentAssertion>
                            <L7p:Comment stringValue="** Portal API Key DB ***********************************"/>
                        </L7p:CommentAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue=""/>
                            <L7p:ContentType stringValue="text/xml;charset=UTF-8"/>
                            <L7p:DataType variableDataType="message"/>
                            <L7p:VariableToSet stringValue="values"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue=""/>
                            <L7p:VariableToSet stringValue="content-type"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:AssertionComment assertionComment="included">
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="initialize"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="will be overwritten in the case of an error"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:AssertionComment>
                            <L7p:Base64Expression stringValue=""/>
                            <L7p:VariableToSet stringValue="error.code"/>
                        </L7p:SetVariable>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:LookupDynamicContextVariables>
                                    <L7p:SourceVariable stringValue="in_apikey_uuid"/>
                                    <L7p:TargetDataType variableDataType="string"/>

                                    <L7p:TargetOutputVariablePrefix stringValue="lookup.apikey_uuid"/>
                                    </L7p:LookupDynamicContextVariables>
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${lookup.apikey_uuid.output}"/>
                                    <L7p:Expression2 stringValue="GET"/>
                                    <L7p:Negate booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue="GET"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:JdbcQuery>
                                    <L7p:AssertionFailureEnabled booleanValue="false"/>
                                    <L7p:ConnectionName stringValue="OAuth"/>

                                    <L7p:ConvertVariablesToStrings booleanValue="false"/>
                                    <L7p:MaxRecords intValue="100000"/>
                                    <L7p:NamingMap mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="apikey"/>
                                    <L7p:value stringValue="apikey"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="apikey_pk"/>
                                    <L7p:value stringValue="apikey_pk"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="apikey_secret"/>
                                    <L7p:value stringValue="apikey_secret"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="created_by"/>
                                    <L7p:value stringValue="created_by"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="label"/>
                                    <L7p:value stringValue="label"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="modified_by"/>
                                    <L7p:value stringValue="modified_by"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="organization"/>
                                    <L7p:value stringValue="organization"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="organization_id"/>
                                    <L7p:value stringValue="organization_id"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="status"/>
                                    <L7p:value stringValue="status"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="updated"/>
                                    <L7p:value stringValue="updated"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="value_xml"/>
                                    <L7p:value stringValue="value_xml"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="created"/>
                                    <L7p:value stringValue="created"/>
                                    </L7p:entry>
                                    </L7p:NamingMap>
                                    <L7p:QueryTimeout stringValue="5"/>
                                    <L7p:SqlQuery stringValueReference="inline"><![CDATA[select apikey_pk, apikey, apikey_secret, status, organization_id, organization, label, value_xml, created_by, modified_by,
	  date_format(DATE_ADD(from_unixtime(0), interval created second), '%Y-%m-%dT%H:%i:%s') created, 
	  date_format(DATE_ADD(from_unixtime(0), interval updated second), '%Y-%m-%dT%H:%i:%s') updated
	from portal_apikey where apikey_pk = ${lookup.apikey_uuid.output}]]></L7p:SqlQuery>
                                    <L7p:VariablePrefix stringValue="query"/>
                                    </L7p:JdbcQuery>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:LookupDynamicContextVariables>
                                    <L7p:SourceVariable stringValue="in_apikey_apikey"/>
                                    <L7p:TargetDataType variableDataType="string"/>

                                    <L7p:TargetOutputVariablePrefix stringValue="lookup.apikey_apikey"/>
                                    </L7p:LookupDynamicContextVariables>
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${lookup.apikey_apikey.output}"/>
                                    <L7p:Expression2 stringValue="GET"/>
                                    <L7p:Negate booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue="GET"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:JdbcQuery>
                                    <L7p:AssertionFailureEnabled booleanValue="false"/>
                                    <L7p:ConnectionName stringValue="OAuth"/>

                                    <L7p:ConvertVariablesToStrings booleanValue="false"/>
                                    <L7p:MaxRecords intValue="100000"/>
                                    <L7p:NamingMap mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="apikey"/>
                                    <L7p:value stringValue="apikey"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="apikey_pk"/>
                                    <L7p:value stringValue="apikey_pk"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="apikey_secret"/>
                                    <L7p:value stringValue="apikey_secret"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="created"/>
                                    <L7p:value stringValue="created"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="created_by"/>
                                    <L7p:value stringValue="created_by"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="label"/>
                                    <L7p:value stringValue="label"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="modified_by"/>
                                    <L7p:value stringValue="modified_by"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="organization"/>
                                    <L7p:value stringValue="organization"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="organization_id"/>
                                    <L7p:value stringValue="organization_id"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="status"/>
                                    <L7p:value stringValue="status"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="updated"/>
                                    <L7p:value stringValue="updated"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="value_xml"/>
                                    <L7p:value stringValue="value_xml"/>
                                    </L7p:entry>
                                    </L7p:NamingMap>
                                    <L7p:QueryTimeout stringValue="5"/>
                                    <L7p:SqlQuery stringValueReference="inline"><![CDATA[select apikey_pk, apikey, apikey_secret, status, organization_id, organization, label, value_xml, created_by, modified_by,
	  date_format(DATE_ADD(from_unixtime(0), interval created second), '%Y-%m-%dT%H:%i:%s') created, 
	  date_format(DATE_ADD(from_unixtime(0), interval updated second), '%Y-%m-%dT%H:%i:%s') updated
	from portal_apikey where apikey = ${lookup.apikey_apikey.output}]]></L7p:SqlQuery>
                                    <L7p:VariablePrefix stringValue="query"/>
                                    </L7p:JdbcQuery>
                                    </wsp:All>
                                    <L7p:JdbcQuery>
                                    <L7p:AssertionFailureEnabled booleanValue="false"/>
                                    <L7p:ConnectionName stringValue="OAuth"/>
                                    <L7p:ConvertVariablesToStrings booleanValue="false"/>
                                    <L7p:MaxRecords intValue="100000"/>
                                    <L7p:NamingMap mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="apikey"/>
                                    <L7p:value stringValue="apikey"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="apikey_pk"/>
                                    <L7p:value stringValue="apikey_pk"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="apikey_secret"/>
                                    <L7p:value stringValue="apikey_secret"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="created_by"/>
                                    <L7p:value stringValue="created_by"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="label"/>
                                    <L7p:value stringValue="label"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="modified_by"/>
                                    <L7p:value stringValue="modified_by"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="organization"/>
                                    <L7p:value stringValue="organization"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="organization_id"/>
                                    <L7p:value stringValue="organization_id"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="status"/>
                                    <L7p:value stringValue="status"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="updated"/>
                                    <L7p:value stringValue="updated"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="value_xml"/>
                                    <L7p:value stringValue="value_xml"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="created"/>
                                    <L7p:value stringValue="created"/>
                                    </L7p:entry>
                                    </L7p:NamingMap>
                                    <L7p:QueryTimeout stringValue="5"/>
                                    <L7p:SqlQuery stringValueReference="inline"><![CDATA[select apikey_pk, apikey, apikey_secret, status, organization_id, organization, label, value_xml, created_by, modified_by,
	  date_format(DATE_ADD(from_unixtime(0), interval created second), '%Y-%m-%dT%H:%i:%s') created, 
	  date_format(DATE_ADD(from_unixtime(0), interval updated second), '%Y-%m-%dT%H:%i:%s') updated
	from portal_apikey]]></L7p:SqlQuery>
                                    <L7p:VariablePrefix stringValue="query"/>
                                    </L7p:JdbcQuery>
                                </wsp:OneOrMore>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="Ww=="/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="apikeyList"/>
                                </L7p:SetVariable>
                                <L7p:ForEachLoop L7p:Usage="Required"
                                    loopVariable="query.apikey_pk" variablePrefix="rec">
                                    <L7p:ItemLookupByIndex>
                                    <L7p:IndexValue stringValue="${rec.iterations}"/>
                                    <L7p:MultivaluedVariableName stringValue="query.apikey_pk"/>
                                    <L7p:OutputVariableName stringValue="_apikey_pk"/>
                                    </L7p:ItemLookupByIndex>
                                    <L7p:ItemLookupByIndex>
                                    <L7p:IndexValue stringValue="${rec.iterations}"/>
                                    <L7p:MultivaluedVariableName stringValue="query.apikey"/>
                                    <L7p:OutputVariableName stringValue="_apikey"/>
                                    </L7p:ItemLookupByIndex>
                                    <L7p:ItemLookupByIndex>
                                    <L7p:IndexValue stringValue="${rec.iterations}"/>
                                    <L7p:MultivaluedVariableName stringValue="query.apikey_secret"/>
                                    <L7p:OutputVariableName stringValue="_apikey_secret"/>
                                    </L7p:ItemLookupByIndex>
                                    <L7p:ItemLookupByIndex>
                                    <L7p:IndexValue stringValue="${rec.iterations}"/>
                                    <L7p:MultivaluedVariableName stringValue="query.status"/>
                                    <L7p:OutputVariableName stringValue="_status"/>
                                    </L7p:ItemLookupByIndex>
                                    <L7p:ItemLookupByIndex>
                                    <L7p:IndexValue stringValue="${rec.iterations}"/>
                                    <L7p:MultivaluedVariableName stringValue="query.organization_id"/>
                                    <L7p:OutputVariableName stringValue="_organization_id"/>
                                    </L7p:ItemLookupByIndex>
                                    <L7p:ItemLookupByIndex>
                                    <L7p:IndexValue stringValue="${rec.iterations}"/>
                                    <L7p:MultivaluedVariableName stringValue="query.organization"/>
                                    <L7p:OutputVariableName stringValue="_organization"/>
                                    </L7p:ItemLookupByIndex>
                                    <L7p:ItemLookupByIndex>
                                    <L7p:IndexValue stringValue="${rec.iterations}"/>
                                    <L7p:MultivaluedVariableName stringValue="query.label"/>
                                    <L7p:OutputVariableName stringValue="_label"/>
                                    </L7p:ItemLookupByIndex>
                                    <L7p:ItemLookupByIndex>
                                    <L7p:IndexValue stringValue="${rec.iterations}"/>
                                    <L7p:MultivaluedVariableName stringValue="query.value_xml"/>
                                    <L7p:OutputVariableName stringValue="_value_xml"/>
                                    </L7p:ItemLookupByIndex>
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:EncodeDecode>
                                    <L7p:SourceVariableName stringValue="_value_xml"/>
                                    <L7p:TargetDataType variableDataType="string"/>
                                    <L7p:TargetVariableName stringValue="_value_xml"/>
                                    <L7p:TransformType transformType="BASE64_DECODE"/>
                                    </L7p:EncodeDecode>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtfdmFsdWVfeG1sfQ=="/>
                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="value_xml"/>
                                    </L7p:SetVariable>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue="_oauthCallbackUrl"/>
                                    <L7p:XmlMsgSrc stringValue="value_xml"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/l7:ApiKey/l7:Security/l7:OAuth/l7:CallbackUrl"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="l7"/>
                                    <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                    </L7p:ResponseXpathAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue=""/>
                                    <L7p:VariableToSet stringValue="_oauthCallbackUrl.result"/>
                                    </L7p:SetVariable>
                                    </wsp:OneOrMore>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue="_oauthScope"/>
                                    <L7p:XmlMsgSrc stringValue="value_xml"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/l7:ApiKey/l7:Security/l7:OAuth/l7:Scope"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="l7"/>
                                    <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                    </L7p:ResponseXpathAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue=""/>
                                    <L7p:VariableToSet stringValue="_oauthScope.result"/>
                                    </L7p:SetVariable>
                                    </wsp:OneOrMore>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue="_oauthType"/>
                                    <L7p:XmlMsgSrc stringValue="value_xml"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/l7:ApiKey/l7:Security/l7:OAuth/l7:Type"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="l7"/>
                                    <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                    </L7p:ResponseXpathAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue=""/>
                                    <L7p:VariableToSet stringValue="_oauthType.result"/>
                                    </L7p:SetVariable>
                                    </wsp:OneOrMore>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue="_custom"/>
                                    <L7p:XmlMsgSrc stringValue="value_xml"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/l7:ApiKey/l7:CustomMetaData"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>

                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="l7"/>

                                    <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>

                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                    </L7p:ResponseXpathAssertion>
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="JHtfY3VzdG9tLnJlc3VsdH0="/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="customMsg"/>
                                    </L7p:SetVariable>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>

                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${customMsg.mainpart}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">

                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">

                                    <L7p:Negated booleanValue="true"/>

                                    <L7p:Operator operator="EMPTY"/>

                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="e30="/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>

                                    <L7p:VariableToSet stringValue="customMsg"/>
                                    </L7p:SetVariable>
                                    </wsp:OneOrMore>
                                    <L7p:EvaluateJsonPathExpressionV2>
                                    <L7p:Expression stringValue="$.subscribed_plans"/>

                                    <L7p:OtherTargetMessageVariable stringValue="customMsg"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:VariablePrefix stringValue="_subscribed_plans"/>
                                    </L7p:EvaluateJsonPathExpressionV2>
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${_subscribed_plans.count}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item binary="included">

                                    <L7p:CaseSensitive booleanValue="false"/>

                                    <L7p:Operator operator="GT"/>

                                    <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="JHtfc3Vic2NyaWJlZF9wbGFucy5yZXN1bHRzfQ=="/>
                                    <L7p:VariableToSet stringValue="subscribed_plans"/>
                                    </L7p:SetVariable>
                                    <L7p:Regex>
                                    <L7p:AutoTarget booleanValue="false"/>

                                    <L7p:OtherTargetMessageVariable stringValue="subscribed_plans"/>
                                    <L7p:Regex stringValue=", "/>
                                    <L7p:RegexName stringValue="json string array"/>
                                    <L7p:Replace booleanValue="true"/>
                                    <L7p:Replacement stringValue="&quot;,&quot;"/>
                                    <L7p:Target target="OTHER"/>
                                    </L7p:Regex>
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="WyIke3N1YnNjcmliZWRfcGxhbnN9Il0="/>
                                    <L7p:VariableToSet stringValue="subscribed_plans"/>
                                    </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="W10="/>
                                    <L7p:VariableToSet stringValue="subscribed_plans"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // subscribed_plans"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:OneOrMore>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue="_custom"/>
                                    <L7p:XmlMsgSrc stringValue="value_xml"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/l7:ApiKey/l7:CustomMetaData"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>

                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="l7"/>

                                    <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>

                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                    </L7p:ResponseXpathAssertion>
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="JHtfY3VzdG9tLnJlc3VsdH0="/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="customMsg"/>
                                    </L7p:SetVariable>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>

                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${customMsg.mainpart}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">

                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">

                                    <L7p:Negated booleanValue="true"/>

                                    <L7p:Operator operator="EMPTY"/>

                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="e30="/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>

                                    <L7p:VariableToSet stringValue="customMsg"/>
                                    </L7p:SetVariable>
                                    </wsp:OneOrMore>
                                    <L7p:EvaluateJsonPathExpressionV2>
                                    <L7p:Expression stringValue="$.custom_fields"/>

                                    <L7p:OtherTargetMessageVariable stringValue="customMsg"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:VariablePrefix stringValue="_custom_fields"/>
                                    </L7p:EvaluateJsonPathExpressionV2>
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${_custom_fields.count}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item binary="included">

                                    <L7p:CaseSensitive booleanValue="false"/>

                                    <L7p:Operator operator="GT"/>

                                    <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="JHtfY3VzdG9tX2ZpZWxkcy5yZXN1bHRzfQ=="/>
                                    <L7p:VariableToSet stringValue="custom_fields"/>
                                    </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="e30="/>
                                    <L7p:VariableToSet stringValue="custom_fields"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // custom_fields"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:OneOrMore>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // value_xml"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:All>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue=""/>
                                    <L7p:VariableToSet stringValue="comma"/>
                                    </L7p:SetVariable>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${rec.iterations}"/>
                                    <L7p:Expression2 stringValue="0"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="LA=="/>
                                    <L7p:VariableToSet stringValue="comma"/>
                                    </L7p:SetVariable>
                                    </wsp:OneOrMore>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="X29yZ2FuaXphdGlvbixfbGFiZWwsX29hdXRoQ2FsbGJhY2tVcmwucmVzdWx0LF9vYXV0aFNjb3BlLnJlc3VsdA=="/>
                                    <L7p:VariableToSet stringValue="jsonEscapeVars"/>
                                    </L7p:SetVariable>
                                    <L7p:Include>
                                    <L7p:PolicyGuid stringValue="01c89bcf-5271-46f6-86f5-27436d2df4ca"/>
                                    <L7p:PolicyName stringValue="APIIDA API Control Plane Integration - JSON Escape"/>
                                    </L7p:Include>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHthcGlrZXlMaXN0Lm1haW5wYXJ0fSR7Y29tbWF9DQp7DQoiaWQiOiAiJHtfYXBpa2V5X3BrfSIsDQoiYXBpa2V5IjogIiR7X2FwaWtleX0iLA0KInNlY3JldCI6ICIke19hcGlrZXlfc2VjcmV0fSIsDQoic3RhdHVzIjogIiR7X3N0YXR1c30iLA0KIm9yZ2FuaXphdGlvbl9pZCI6ICIke19vcmdhbml6YXRpb25faWR9IiwNCiJvcmdhbml6YXRpb24iOiAiJHtfb3JnYW5pemF0aW9ufSIsDQoibGFiZWwiOiAiJHtfbGFiZWx9IiwNCiJvYXV0aENhbGxiYWNrVXJsIjogIiR7X29hdXRoQ2FsbGJhY2tVcmwucmVzdWx0fSIsDQoib2F1dGhTY29wZSI6ICIke19vYXV0aFNjb3BlLnJlc3VsdH0iLA0KIm9hdXRoVHlwZSIgOiIke19vYXV0aFR5cGUucmVzdWx0fSIsDQoic3Vic2NyaWJlZF9wbGFucyI6ICR7c3Vic2NyaWJlZF9wbGFuc30sDQoiY3VzdG9tX2ZpZWxkcyI6ICAke2N1c3RvbV9maWVsZHN9DQp9"/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="apikeyList"/>
                                    </L7p:SetVariable>
                                </L7p:ForEachLoop>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHthcGlrZXlMaXN0Lm1haW5wYXJ0fV0="/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="apikeyList"/>
                                </L7p:SetVariable>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="MDAw"/>
                                    <L7p:VariableToSet stringValue="error.code"/>
                                </L7p:SetVariable>
                                <L7p:FalseAssertion/>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="error"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="connection failed"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                        </wsp:OneOrMore>
                        <L7p:CommentAssertion>
                            <L7p:Comment stringValue="** Portal API Key DB ***********************************"/>
                        </L7p:CommentAssertion>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="sql"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${dbsystem}"/>
                            <L7p:Expression2 stringValue="cassandra"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="cassandra"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:Encapsulated>
                            <L7p:EncapsulatedAssertionConfigGuid stringValue="cdbd3438-a0d7-4f3f-873c-d8a25c02bd64"/>
                            <L7p:EncapsulatedAssertionConfigName stringValue="Portal API Key Count NoSQL"/>
                        </L7p:Encapsulated>
                        <L7p:CommentAssertion>
                            <L7p:Comment stringValue="** Portal API Key NoSQL needs to be implemented"/>
                        </L7p:CommentAssertion>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="non-sql"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="database"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="local"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${isLocal}"/>
                    <L7p:Expression2 stringValue="false"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item binary="included">
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:RightValue stringValue="false"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue=""/>
                    <L7p:ContentType stringValue="text/plain; charset=utf-8"/>
                    <L7p:DataType variableDataType="message"/>
                    <L7p:VariableToSet stringValue="emptyMsg"/>
                </L7p:SetVariable>
                <L7p:HttpRoutingAssertion>
                    <L7p:AssertionComment assertionComment="included">
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="no-fail"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// always succeed"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:AssertionComment>
                    <L7p:CurrentSecurityHeaderHandling intValue="3"/>
                    <L7p:FailOnErrorStatus booleanValue="false"/>
                    <L7p:HttpMethod httpMethod="GET"/>
                    <L7p:PassThroughSoapFaults booleanValue="false"/>
                    <L7p:ProtectedServiceUrl stringValue="${host_oauth_clientstore_server}/portal/storage"/>
                    <L7p:ProxyPassword stringValueNull="null"/>
                    <L7p:ProxyUsername stringValueNull="null"/>
                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                        <L7p:ForwardAll booleanValue="true"/>
                        <L7p:Rules httpPassthroughRules="included"/>
                    </L7p:RequestHeaderRules>
                    <L7p:RequestMsgSrc stringValue="emptyMsg"/>
                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                        <L7p:ForwardAll booleanValue="true"/>
                        <L7p:Rules httpPassthroughRules="included"/>
                    </L7p:RequestParamRules>
                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                        <L7p:ForwardAll booleanValue="true"/>
                        <L7p:Rules httpPassthroughRules="included"/>
                    </L7p:ResponseHeaderRules>
                    <L7p:ResponseMsgDest stringValue="resp"/>
                    <L7p:SamlAssertionVersion intValue="2"/>
                </L7p:HttpRoutingAssertion>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXNwLmh0dHAuaGVhZGVyLngtY2EtZXJyfQ=="/>
                    <L7p:VariableToSet stringValue="error.code"/>
                </L7p:SetVariable>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                        <L7p:Expression2 stringValue="500"/>
                        <L7p:Operator operator="LT"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Operator operator="LT"/>
                                <L7p:RightValue stringValue="500"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${error.code}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:Negate booleanValue="true"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <wsp:All wsp:Usage="Required">
                        <L7p:AuditDetailAssertion>
                            <L7p:CustomLoggerSuffix stringValue="apiida.aacp.logger"/>
                            <L7p:Detail stringValue="Routing failed to ${host_oauth_clientstore_server}/portal/storage!"/>
                            <L7p:Level stringValue="WARNING"/>
                        </L7p:AuditDetailAssertion>
                        <L7p:SetVariable>
                            <L7p:AssertionComment assertionComment="included">
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="error code"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="set error code to 000"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:AssertionComment>
                            <L7p:Base64Expression stringValue="MDAw"/>
                            <L7p:VariableToSet stringValue="error.code"/>
                        </L7p:SetVariable>
                        <L7p:FalseAssertion/>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="error"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="routing errors"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${error.code}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <wsp:All wsp:Usage="Required">
                        <L7p:Regex>
                            <L7p:AssertionComment assertionComment="included">
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="capture"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="capture the last 3 digits"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:AssertionComment>
                            <L7p:AutoTarget booleanValue="false"/>
                            <L7p:OtherTargetMessageVariable stringValue="error.code"/>
                            <L7p:Regex stringValue="(\d{0,16})(\d{3})$"/>
                            <L7p:Replace booleanValue="true"/>
                            <L7p:Replacement stringValue="$2"/>
                            <L7p:Target target="OTHER"/>
                        </L7p:Regex>
                        <L7p:FalseAssertion/>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="error"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="error.code"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXNwLmh0dHAuaGVhZGVyLmNvbnRlbnQtdHlwZX0="/>
                    <L7p:VariableToSet stringValue="content-type"/>
                </L7p:SetVariable>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="remote"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
        </wsp:OneOrMore>
    </wsp:All>
</wsp:Policy>
